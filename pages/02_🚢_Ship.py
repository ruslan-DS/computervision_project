import torch
import streamlit as st
import numpy as np
from PIL import Image
from requests import get
from io import BytesIO
from torchvision import io

from model.model_1 import predict_1
from model.model_2 import predict_2

choice_model = None
image = None
push_model = False
video='images/IMG_9885.mp4'

st.write("""
 # –î–µ—Ç–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ YOLOv5 & YOLOv8nüîé
""")

st.info("–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–≤–µ –º–æ–¥–µ–ª–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å—É–¥–æ–≤ –∏ –∫–æ—Ä–∞–±–ª–µ–π –Ω–∞ —Ñ–æ—Ç–æ—Å–Ω–∏–º–∫–∞—Ö. \n"
        "–í–µ—Å–∞ –º–æ–¥–µ–ª–∏ YOLOv5 —Å–¥–µ–ª–∞–Ω—ã –†—É—Å–ª–∞–Ω–æ–º, –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏ YOLOv8 - –†–æ–º–∞–Ω–æ–º. –ö–∞–∫—É—é –ø–∞–ª–æ—á–∫—É Twix –≤—ã–±–µ—Ä–µ—à—å —Ç—ã, —Ä–µ—à–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–±–µ!ü•∞")

with st.sidebar:
    st.info('–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è: \n')
    choice_model = st.radio('–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å:', options=['YOLOv5', 'YOLOv8'], index=None)

    if choice_model is not None:
        st.info('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:')

        st.warning('üìç–í–ù–ò–ú–ê–ù–ò–ï: –§–∞–π–ª/–∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .jpg/jpeg')
        choice_image = st.radio('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Å–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–æ–µ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏:', options=['URL-–∞–¥—Ä–µ—Å', '–§–∞–π–ª'], index=None)


        if choice_image == 'URL-–∞–¥—Ä–µ—Å':
            image = st.text_input('–í—Å—Ç–∞–≤—å—Ç–µ URL-–∞–¥—Ä–µ—Å —Å–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏')

            if image != '':

                response = get(image)
                image_url = Image.open(BytesIO(response.content))

        elif choice_image == '–§–∞–π–ª':
            image = st.file_uploader('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤')

            if image is not None:

                image_url = Image.open(image)

        if image is not None and image != '':
            st.info('–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã: '
                       '\n- –ö–æ—Ä–∞–±–ª–∏ \n- –°—É–¥–Ω–∞ \n- –õ–æ–¥–∫–∏'
                       '\n\n–û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–ª–∏ –∂–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –Ω–µ–≤–µ—Ä–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–µ–π!ü•≤')
            push_model = st.button('–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –¥–µ—Ç–µ–∫—Ç—Ä–æ–≤–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±—ä–µ–∫—Ç(—ã) –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ')


if image is not None and image != '':
    st.subheader('–í—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ —Å–ª–µ–¥—É—é—â—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é:')
    st.image(image, use_column_width=True, caption='–í–∞—à–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è')

if push_model:
    if choice_model == 'YOLOv5':
        predict = predict_1(image_url)
        render_predict = predict.render()
        st.image(render_predict, use_column_width=True, caption='–§–æ—Ç–æ —Å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º(—Ç–∞–º–∏)')
    #  –¢–£–¢ –ü–†–ï–î–°–ö–ê–ó–´–í–ê–ï–¢ –ú–û–î–ï–õ–¨ –†–£–°–õ–ê–ù–ê
    elif choice_model == 'YOLOv8':
        predict = predict_2(image_url)
        detect_img = Image.fromarray(predict)
        st.image(detect_img, use_column_width=True, caption='–§–æ—Ç–æ —Å –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º(—Ç–∞–º–∏)')
    # –¢–£–¢ –ü–†–ï–î–°–ö–ê–ó–´–í–ê–ï–¢ –ú–û–î–ï–õ–¨ –†–û–ú–´

if st.checkbox('–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –¥–µ—Ç–µ–∫—Ü–∏—é –º–æ–¥–µ–ª–∏ YOLOv5üìπ'):

    st.info("–ú–æ–¥–µ–ª—å YOLO –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–ª—è –∑–∞–¥–∞—á –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏. –û–¥–Ω–∞–∫–æ, –∫–∞–∂–µ—Ç—Å—è, \
            —á—Ç–æ –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –≤–∏–¥–µ–æ —Å–ª–æ–∂–Ω–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏. –ù–æ –Ω–µ —Ç—É—Ç —Ç–æ –±—ã–ª–æ!üòè \
            \n–ü—Ä–∏ –¥–æ–ª–∂–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Å–æ–≤ –ø–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∑–∞–¥–∞—á—É –º–æ–¥–µ–ª—å YOLO —Å–ø–æ—Å–æ–±–Ω–∞ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –Ω–∞ –≤–∏–¥–µ–æ –Ω—É–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.")

    st.write("""
     #### ‚Ä¢ –ù–∞ –≤–∏–¥–µ–æ –ø—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ YOLOv5l
    """)

    st.video(video)

    st.warning("üìç–í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –í–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞—á–∞—Ç—å –µ–≥–æ —Å GitHub'–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø–∞–ø–∫–µ /images \
    –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ!")
